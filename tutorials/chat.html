<!DOCTYPE html><html><head><meta charSet="utf-8"/><link rel="apple-touch-icon" sizes="57x57" href="/static/images/icons/apple-icon-57x57.png"/><link rel="apple-touch-icon" sizes="60x60" href="/static/images/icons/apple-icon-60x60.png"/><link rel="apple-touch-icon" sizes="72x72" href="/static/images/icons/apple-icon-72x72.png"/><link rel="apple-touch-icon" sizes="76x76" href="/static/images/icons/apple-icon-76x76.png"/><link rel="apple-touch-icon" sizes="114x114" href="/static/images/icons/apple-icon-114x114.png"/><link rel="apple-touch-icon" sizes="120x120" href="/static/images/icons/apple-icon-120x120.png"/><link rel="apple-touch-icon" sizes="144x144" href="/static/images/icons/apple-icon-144x144.png"/><link rel="apple-touch-icon" sizes="152x152" href="/static/images/icons/apple-icon-152x152.png"/><link rel="apple-touch-icon" sizes="180x180" href="/static/images/icons/apple-icon-180x180.png"/><link rel="icon" type="image/png" sizes="192x192" href="/static/images/icons/android-icon-192x192.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/images/icons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/static/images/icons/favicon-96x96.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/images/icons/favicon-16x16.png"/><meta name="viewport" content="width=device-width"/><link rel="stylesheet" type="text/css" href="/static/css/bootstrap.min.css"/><link rel="stylesheet" type="text/css" href="/static/css/bebasNeue.css"/><link rel="stylesheet" type="text/css" href="/static/css/animations.css"/><link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700,800|Roboto:100,300,400,500,700,900" rel="stylesheet"/><title>Actionhero</title><script src="/static/js/googleAnalytics.js"></script><meta name="next-head-count" content="21"/><link rel="preload" href="/_next/static/cH25b_MVvsTrAlL3XbUsR/pages/tutorials/%5Bname%5D.js" as="script"/><link rel="preload" href="/_next/static/cH25b_MVvsTrAlL3XbUsR/pages/_app.js" as="script"/><link rel="preload" href="/_next/static/runtime/webpack-b65cab0b00afd201cbda.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.c1a6d8f83ab8e8b22967.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.e8528572040b4e4e9696.js" as="script"/><link rel="preload" href="/_next/static/runtime/main-4fc23337c30014ee9849.js" as="script"/><link rel="preload" href="/_next/static/chunks/e3455ea4f5ab842b4397e2e16fe9c64bb70db0dc.47e0d1a9e86c1d20dd79.js" as="script"/><link rel="preload" href="/_next/static/chunks/c592c32e2ecae3769b84f6c98ccafd89b38b2c86.ba5e9ee7f902f9f7167a.js" as="script"/><link rel="preload" href="/_next/static/chunks/a5807bfcda65e4b2d08436e83f0c86f84aba6140.b4273f33c7a002dad56c.js" as="script"/></head><body><div id="__next"><div><div style="padding-left:0;padding-right:0;font-family:Roboto, sans-serif;font-size:14px;font-weight:300" class="container-fluid"><header style="background-color:#2F5266"><div class="container"><nav style="background-color:#2F5266;padding-top:5px;margin-bottom:10px;border:0" class="navbar navbar-default"><div class="container"><div class="navbar-header"><a style="padding-top:0;margin-bottom:15px" class="navbar-brand"><img src="/static/images/actionhero-logo-header-wordmark.svg" style="padding-top:14px;padding-bottom:20px"/></a><button type="button" class="navbar-toggle collapsed"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button></div><div class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"></ul><ul class="hidden-md hidden-sm hidden-xs nav navbar-nav navbar-left"><li role="presentation" class=""><a role="button" href="#"> </a></li><li role="presentation" class=""><a role="button" href="#"> </a></li></ul><ul class="nav navbar-nav navbar-left"><li role="presentation" class="hidden-sm"><a role="button" href="#"><span style="line-height:3;color:#FFFFFF;padding-bottom:10px;font-weight:300">Why Actionhero</span></a></li><li role="presentation" class=""><a role="button" href="#"><span style="line-height:3;color:#FFFFFF;padding-bottom:10px;font-weight:300">Downloads</span></a></li><li role="presentation" class=""><a role="button" href="#"><span style="line-height:3;color:#FFFFFF;padding-bottom:10px;font-weight:300">Tutorials</span></a></li><li role="presentation" class=""><a role="button" href="#"><span style="line-height:3;color:#FFFFFF;padding-bottom:10px;font-weight:300">Documentation</span></a></li><li role="presentation" class="hidden-sm"><a role="button" href="#"><span style="line-height:3;color:#FFFFFF;padding-bottom:10px;font-weight:300">Plugins</span></a></li><li role="presentation" class=""><a role="button" href="#"><span style="line-height:3;color:#FFFFFF;padding-bottom:10px;font-weight:300">Community</span></a></li><li role="presentation" class=""><a role="button" href="#"><span style="line-height:3;color:#FFFFFF;padding-bottom:10px;font-weight:300">Shop</span></a></li></ul><ul class="nav navbar-nav navbar-right"><div><a style="text-decoration:none" href="/get-started"><button style="font-family:Roboto, sans-serif;font-size:14px;max-width:200px;border-radius:50px;margin:0 auto;color:#FFFFFF;background-color:#E14E3A;border-color:#E14E3A;font-weight:300;margin-top:20px;margin-bottom:0;margin-left:10px;margin-right:10px;outline:none" type="button" class="btn btn-lg btn-default btn-block">Get Started</button></a></div></ul></div></div></nav></div></header></div><div style="padding-left:0;padding-right:0;font-family:Roboto, sans-serif;font-size:14px;font-weight:300" class="container-fluid"><div style="background-color:#FBF9E4;color:#2F5266;font-weight:200;padding:50px"><div class="container"><div class="row"><div style="text-align:center" class="col-md-3"><img src="/static/images/chat.svg"/></div><div style="text-align:center" class="col-md-6"><h1 style="font-family:BebasNeue, Roboto, sans-serif;font-weight:bold;margin-top:20px;margin-bottom:10px;letter-spacing:2px;font-size:36px"><br/>Chat</h1></div><div class="col-md-3"></div></div></div></div><div style="height:183px;background:url(&quot;/static/images/clouds-white.svg&quot;) no-repeat center #FBF9E4"></div><div style="padding-bottom:100px" class="container"><div class="row"><div id="_top"></div><div id="docPageContent" class="col-md-12"><div id="tutorialPageContent" class="row"><div class="col-md-9"><div><div id="General"><br/><h2 style="font-family:Roboto, sans-serif;font-weight:300;font-size:20px;line-height:1.5em;color:#3B5D72"><span style="font-weight:300;font-size:36px">General</span></h2><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/></div></div><p>Actionhero ships with a chat framework which may be used by all persistent connections (<code>socket</code> and <code>websocket</code>). There are methods to create and manage chat rooms and control the users in those rooms. Chat does not have to be for peer-to-peer communication, and is a metaphor used for many things, including the sharing of all realtime data between client and server, and client to client. This can be used for games, syndication, etc.</p><p>Clients themselves interact with rooms via <code>verbs</code>. Verbs are short-form commands that will attempt to modify the connection&#x27;s state, either joining or leaving a room. Clients can be in many rooms at once.</p><p>Relevant chat verbs are:</p><ul><li><code>roomAdd</code></li><li><code>roomLeave</code></li><li><code>roomView</code></li><li><code>say</code></li></ul><p>The special verb for persistent connections <code>say</code> makes use of <code>chatRoom.broadcast</code> to tell a message to all other users in the room, IE: <code>say myRoom Hello World</code> from a socket client or <code>client.say(&quot;myRoom&quot;, &#x27;Hello World&quot;)</code> for a websocket.</p><p>Chat on multiple Actionhero nodes relies on redis for both chat (pub/sub) and a key store defined by <code>config.redis</code>. The redis pub/sub server and the key store don&#x27;t need to be the same instance of redis, but they do need to be the same for all Actionhero servers you are running in the cluster. This is how Actionhero scales the chat features.</p><p>There is no limit to the number of rooms which can be created, but keep in mind that each room stores information in redis, and there load created for each connection.</p><div><div id="Examples"><br/><h2 style="font-family:Roboto, sans-serif;font-weight:300;font-size:20px;line-height:1.5em;color:#3B5D72"><span style="font-weight:300;font-size:36px">Examples</span></h2><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/></div></div><p>The full documentation for the chatRoom module can be found here: <a href="https://docs.actionherojs.com/modules/chatroom.html">https://docs.actionherojs.com/modules/chatroom.html</a></p><p>In an initializer, ensure a room exists and log the room membership every minute</p><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff"><code><span style="color:#408080;font-style:italic">// in an initializer, /src/initializers/lobby.ts</span>
<span style="color:#954121">import</span> { Initializer, chatRoom, log } <span style="color:#954121">from</span> <span style="color:#219161">&quot;actionhero&quot;</span>;

<span style="color:#954121">let</span> timer: NodeJS.Timeout;

<span style="color:#954121">export</span> <span style="color:#954121">class</span> MyInitializer <span style="color:#954121">extends</span> Initializer {
  <span style="color:#954121">constructor</span>(<span style="color:#00f"></span>) {
    <span style="color:#954121">super</span>();
    <span style="color:#954121">this</span>.name = <span style="color:#219161">&quot;rooms&quot;</span>;
  }

  <span style="color:#954121">async</span> initialize() {
    <span style="color:#408080;font-style:italic">// ensure a room exists</span>
    <span style="color:#954121">const</span> lobbyExists = <span style="color:#954121">await</span> chatRoom.exists(<span style="color:#219161">&quot;lobby&quot;</span>);
    <span style="color:#954121">if</span> (!lobbyExists) {
      <span style="color:#954121">await</span> chatRoom.add(<span style="color:#219161">&quot;lobby&quot;</span>);
    }
  }

  <span style="color:#954121">async</span> start() {
    timer = setInterval(<span class="hljs-function"><span style="color:#00f">()</span> =&gt;</span> {
      <span style="color:#954121">this</span>.logLobbyStatus();
    }, <span style="color:#40a070">60</span> * <span style="color:#40a070">1000</span>);
  }

  <span style="color:#954121">async</span> stop() {
    <span style="color:#954121">if</span> (timer) {
      clearInterval(timer);
    }
  }

  <span style="color:#954121">async</span> logLobbyStatus() {
    <span style="color:#954121">const</span> { membersCount } = <span style="color:#954121">await</span> chatRoom.roomStatus(<span style="color:#219161">&quot;lobby&quot;</span>);
    log(<span style="color:#219161">`lobby has <span style="color:#954121">${membersCount}</span> members`</span>);
  }
}</code></pre><p>And if you want to broadcast a message to all clients in a room, you can use:</p><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff"><code><span style="color:#408080;font-style:italic">// client should either be a real client you are emulating (found in api.connections) or just `{}`</span>
<span style="color:#408080;font-style:italic">// room is the string name of a room</span>
<span style="color:#408080;font-style:italic">// message is a string or JSON</span>
chatRoom.broadcast(connection, room, message);</code></pre><div><div id="Middleware"><br/><h2 style="font-family:Roboto, sans-serif;font-weight:300;font-size:20px;line-height:1.5em;color:#3B5D72"><span style="font-weight:300;font-size:36px">Middleware</span></h2><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/></div></div><p>There are 4 types of middleware you can install for the chat system: <code>say</code>, <code>onSayReceive</code>, <code>join</code>, and <code>leave</code>. You can learn more about <a href="/tutorials/middleware#Chat%20Middleware">chat middleware in the middleware section of this site</a>. Using middleware when messages are sent or when connections join rooms is how you build up authentication and more complex workflows.</p><div><div id="Specific Client Communication"><br/><h2 style="font-family:Roboto, sans-serif;font-weight:300;font-size:20px;line-height:1.5em;color:#3B5D72"><span style="font-weight:300;font-size:36px">Specific Client Communication</span></h2><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/></div></div><p>Every connection object also has a <code>connection.sendMessage(message)</code> method which you can call directly from the server.</p><div><div id="Client Use"><br/><h2 style="font-family:Roboto, sans-serif;font-weight:300;font-size:20px;line-height:1.5em;color:#3B5D72"><span style="font-weight:300;font-size:36px">Client Use</span></h2><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/></div></div><p>The details of communicating within a chat room are up to each individual server (see <a href="/tutorials/websocket-server">websocket</a>).</p><ul><li>Client will join a room (<code>client.roomAdd(room)</code>).</li><li>Once in the room, clients can send messages (which are strings) to everyone else in the room via <code>say</code>, ie: <code>{client.say(&#x27;room&#x27;, Hello World&#x27;)}</code></li><li>Once a client is in a room, they will revive messages from other members of the room as events. For example, catching say events from the websocket client looks like <code>{client.on(&#x27;say&#x27;, function(message){ console.log(message); })}</code>. You can inspect <code>message.room</code> if you are in more than one room.<ul><li>The payload of a message will contain the room, sender, and the message body: <code>{{message: &quot;Hello World&quot;, room: &quot;SecretRoom&quot;, from: &quot;7d419af9-accf-40ac-8d78-9281591dd59e&quot;, context: &quot;user&quot;, sentAt: 1399437579346}</code>}</li></ul></li></ul><p>If you want to create an authenticated room, there are 2 steps:</p><ul><li>First, create an action which modifies some property either on the connection object it self, or stores permissions to a database.</li><li>Then, create a <code>join</code>-style middleware which checks these values. In this middleware, you can determine if the connection should be added to the room or not.</li></ul></div><div class="hidden-xs hidden-sm col-md-3"><div style="height:0"><div style="padding-top:90px;position:sticky;top:0"><ul style="list-style-type:none;padding-left:0;margin-left:0"></ul></div></div></div></div><br/><div><a style="text-decoration:none" href="/tutorials"><button style="font-family:Roboto, sans-serif;font-weight:300;font-size:14px;max-width:200px;border-radius:50px;margin:0 auto;color:#FFFFFF;background-color:#E14E3A;border-color:#E14E3A;margin-top:20px;margin-bottom:20px;padding-top:15px;padding-bottom:15px;outline:none" type="button" class="btn btn-lg btn-default btn-block">Back to Tutorials</button></a></div></div><div class="hidden-xs hidden-sm col-md-3"></div></div></div><div style="background-color:#6E8898;color:#2F5266;font-weight:300;padding-top:100px;padding-bottom:100px"><div class="container"><div class="row"><div class="col-md-2"></div><div style="text-align:center;color:#FBF9E4;padding-bottom:100px" class="col-md-8"><h1 style="font-family:BebasNeue, Roboto, sans-serif;font-weight:bold;margin-top:20px;margin-bottom:10px;letter-spacing:2px;font-size:36px">Solutions</h1><h2 style="font-family:Roboto, sans-serif;font-weight:300;font-size:20px;line-height:1.5em;color:#3B5D72"><span style="color:#FBF9E4">Actionhero was built from the ground up to include all the features you expect from a modern API framework.</span></h2></div><div class="col-md-2"></div></div><div class="row"><div class="col-md-4"><div style="width:100%;padding-top:40px;padding-bottom:40px;padding-left:40px;padding-right:50px;background-color:#FBF9E4;box-shadow:0px 2px 4px #003C51"><div style="text-align:center;padding-bottom:10px"><h1 style="font-family:BebasNeue, Roboto, sans-serif;font-weight:bold;margin-top:20px;margin-bottom:10px;letter-spacing:2px;font-size:36px">Open Source</h1></div><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/><p>The Actionhero server is open source, under the Apache-2 license</p><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/><p>Actionhero runs on Linux, OS X, and Windows</p><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/><p>You always have access to the Actionhero team via<!-- --> <a href="/community">Slack and Github</a></p><br/><br/><div><a style="text-decoration:none" href="/downloads"><button style="font-family:Roboto, sans-serif;font-weight:300;font-size:14px;max-width:200px;border-radius:50px;margin:0 auto;color:#FFFFFF;background-color:#E14E3A;border-color:#E14E3A;margin-top:20px;margin-bottom:20px;padding-top:15px;padding-bottom:15px;outline:none" type="button" class="btn btn-lg btn-default btn-block">Download</button></a></div></div></div><div class="hidden-md hidden-lg hidden-xl col-md-4"><div style="width:100%;padding:20px;background-color:#2F5266;color:#FFFFFF;box-shadow:0px 2px 4px #003C51"><div style="text-align:center"><img src="/static/images/dog.svg"/><h1 style="font-family:BebasNeue, Roboto, sans-serif;font-weight:bold;margin-top:20px;margin-bottom:10px;letter-spacing:2px;font-size:36px"><span style="color:#FBF9E4">Premium Training &amp; Review</span></h1></div><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/><p>We provide support for corporate &amp; nonprofit customers starting at a flat rate of $150/hr. Our services include:</p><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/><ul><li><strong>Remote training for your team</strong></li><li><strong>Code Reviews</strong></li><li><strong>Best Practices Audits</strong></li><li><strong>Custom plugin &amp; Feature Development</strong></li></ul><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/><p>We have packages appropriate for all company sizes. Contact us to learn more.</p><br/><div><button style="font-family:Roboto, sans-serif;font-weight:300;font-size:14px;max-width:200px;border-radius:50px;margin:0 auto;color:#FFFFFF;background-color:#E14E3A;border-color:#E14E3A;margin-top:20px;margin-bottom:20px;padding-top:15px;padding-bottom:15px;outline:none" type="button" class="btn btn-lg btn-default btn-block">Contact Us</button></div></div></div><div class="hidden-xs hidden-sm col-md-4"><div style="width:125%;padding:40px;background-color:#2F5266;color:#FFFFFF;position:relative;top:-60px;box-shadow:0px 2px 4px #003C51;margin-left:-13%;margin-right:-5%;z-index:10"><div style="text-align:center;padding-bottom:10px"><img src="/static/images/dog.svg"/><h1 style="font-family:BebasNeue, Roboto, sans-serif;font-weight:bold;margin-top:20px;margin-bottom:10px;letter-spacing:2px;font-size:36px">Premium Training &amp; Review</h1></div><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/><p>We provide support for corporate &amp; nonprofit customers starting at a flat rate of $150/hr. Our services include:</p><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/><ul><li><strong>Remote training for your team</strong></li><li><strong>Code Reviews</strong></li><li><strong>Best Practices Workshops</strong></li><li><strong>Custom plugin &amp; Feature Development</strong></li></ul><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/><p>We have packages appropriate for all company sizes. Contact us to learn more.</p><br/><div><button style="font-family:Roboto, sans-serif;font-weight:300;font-size:14px;max-width:200px;border-radius:50px;margin:0 auto;color:#FFFFFF;background-color:#E14E3A;border-color:#E14E3A;margin-top:20px;margin-bottom:20px;padding-top:15px;padding-bottom:15px;outline:none" type="button" class="btn btn-lg btn-default btn-block">Contact Us</button></div></div></div><div class="col-md-4"><div style="width:100%;padding-top:40px;padding-bottom:40px;padding-right:40px;padding-left:50px;background-color:#FBF9E4;box-shadow:0px 2px 4px #003C51"><div style="text-align:center;padding-bottom:10px"><h1 style="font-family:BebasNeue, Roboto, sans-serif;font-weight:bold;margin-top:20px;margin-bottom:10px;letter-spacing:2px;font-size:36px">Enterprise</h1></div><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/><p>For larger customers in need of a support contract, we offer an enterprise plan including everything in the Premium plan plus:</p><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/><ul><li><strong>24/7 access to core members of the Actionhero Team</strong></li><li><strong>Emergency response packages</strong></li><li><strong>Deployment support</strong></li><li><strong>...and custom development against Actionhero’s core as needed.</strong></li></ul><br/><div><button style="font-family:Roboto, sans-serif;font-weight:300;font-size:14px;max-width:200px;border-radius:50px;margin:0 auto;color:#FFFFFF;background-color:#E14E3A;border-color:#E14E3A;margin-top:20px;margin-bottom:20px;padding-top:15px;padding-bottom:15px;outline:none" type="button" class="btn btn-lg btn-default btn-block">Contact Us</button></div></div></div></div></div></div></div><div style="padding-left:0;padding-right:0;font-family:Roboto, sans-serif;font-size:14px;font-weight:300" class="container-fluid"><footer id="footer-container" style="background-color:#2F5266;color:#FBF9E4;font-family:Roboto, sans-serif;font-weight:200"><div class="container"><div style="padding-bottom:50px;padding-top:50px;padding-left:100px" class="row"><div class="col-md-12"><img src="/static/images/actionhero-logo-header-wordmark.svg"/></div></div><div style="padding-bottom:100px" class="row"><div class="col-md-4"><div style="padding-left:100px"><p><a style="color:#FBF9E4" href="/terms">Terms</a></p><p>Contact us at<!-- --> <a style="color:#FBF9E4;font-weight:500" href="mailto:hello@actionherojs.com">hello@actionherojs.com</a></p><p>You can contribute to this website<!-- --> <a style="color:#FBF9E4;font-weight:500" href="https://github.com/actionhero/www.actionherojs.com" target="_blank">here</a>.</p><p><a href="https://medium.com/tag/actionherojs/latest" target="_new" style="color:#FBF9E4">Blogs</a></p><p style="color:#FFFFFF;font-weight:bold">© 2020<!-- --> <!-- -->Actionhero</p></div></div><div class="col-md-4"><div style="padding-left:100px"><p><a style="color:#FBF9E4" href="/why">Why Actionhero</a></p><p><a style="color:#FBF9E4" href="/get-started">Get Started</a></p><p><a href="https://docs.actionherojs.com" style="color:#FBF9E4">Documenation</a></p><p><a style="color:#FBF9E4" href="/solutions">Solutions</a></p><p><a style="color:#FBF9E4" href="/community">Community</a></p><p><a style="color:#FBF9E4" href="/downloads">Downloads</a></p></div></div><div class="col-md-4"><div style="padding-left:100px"><p><a href="https://www.npmjs.com/package/actionhero" target="_new" style="color:#FBF9E4">NPM</a></p><p><a href="https://twitter.com/actionherojs" target="_new" style="color:#FBF9E4">Twitter</a></p><p><a href="https://slack.actionherojs.com/" target="_new" style="color:#FBF9E4">Slack</a></p><p><a href="https://github.com/Actionhero/Actionhero" target="_new" style="color:#FBF9E4">Github</a></p><p><a href="https://actionherojs.threadless.com" target="_new" style="color:#FBF9E4">Shop</a></p></div></div></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"markdown":"## General\n\nActionhero ships with a chat framework which may be used by all persistent connections (`socket` and `websocket`). There are methods to create and manage chat rooms and control the users in those rooms. Chat does not have to be for peer-to-peer communication, and is a metaphor used for many things, including the sharing of all realtime data between client and server, and client to client. This can be used for games, syndication, etc.\n\nClients themselves interact with rooms via `verbs`. Verbs are short-form commands that will attempt to modify the connection's state, either joining or leaving a room. Clients can be in many rooms at once.\n\nRelevant chat verbs are:\n\n- `roomAdd`\n- `roomLeave`\n- `roomView`\n- `say`\n\nThe special verb for persistent connections `say` makes use of `chatRoom.broadcast` to tell a message to all other users in the room, IE: `say myRoom Hello World` from a socket client or `client.say(\"myRoom\", 'Hello World\")` for a websocket.\n\nChat on multiple Actionhero nodes relies on redis for both chat (pub/sub) and a key store defined by `config.redis`. The redis pub/sub server and the key store don't need to be the same instance of redis, but they do need to be the same for all Actionhero servers you are running in the cluster. This is how Actionhero scales the chat features.\n\nThere is no limit to the number of rooms which can be created, but keep in mind that each room stores information in redis, and there load created for each connection.\n\n## Examples\n\nThe full documentation for the chatRoom module can be found here: [https://docs.actionherojs.com/modules/chatroom.html](https://docs.actionherojs.com/modules/chatroom.html)\n\nIn an initializer, ensure a room exists and log the room membership every minute\n\n```ts\n// in an initializer, /src/initializers/lobby.ts\nimport { Initializer, chatRoom, log } from \"actionhero\";\n\nlet timer: NodeJS.Timeout;\n\nexport class MyInitializer extends Initializer {\n  constructor() {\n    super();\n    this.name = \"rooms\";\n  }\n\n  async initialize() {\n    // ensure a room exists\n    const lobbyExists = await chatRoom.exists(\"lobby\");\n    if (!lobbyExists) {\n      await chatRoom.add(\"lobby\");\n    }\n  }\n\n  async start() {\n    timer = setInterval(() =\u003e {\n      this.logLobbyStatus();\n    }, 60 * 1000);\n  }\n\n  async stop() {\n    if (timer) {\n      clearInterval(timer);\n    }\n  }\n\n  async logLobbyStatus() {\n    const { membersCount } = await chatRoom.roomStatus(\"lobby\");\n    log(`lobby has ${membersCount} members`);\n  }\n}\n```\n\nAnd if you want to broadcast a message to all clients in a room, you can use:\n\n```ts\n// client should either be a real client you are emulating (found in api.connections) or just `{}`\n// room is the string name of a room\n// message is a string or JSON\nchatRoom.broadcast(connection, room, message);\n```\n\n## Middleware\n\nThere are 4 types of middleware you can install for the chat system: `say`, `onSayReceive`, `join`, and `leave`. You can learn more about [chat middleware in the middleware section of this site](/tutorials/middleware#Chat%20Middleware). Using middleware when messages are sent or when connections join rooms is how you build up authentication and more complex workflows.\n\n## Specific Client Communication\n\nEvery connection object also has a `connection.sendMessage(message)` method which you can call directly from the server.\n\n## Client Use\n\nThe details of communicating within a chat room are up to each individual server (see [websocket](/tutorials/websocket-server)).\n\n- Client will join a room (`client.roomAdd(room)`).\n- Once in the room, clients can send messages (which are strings) to everyone else in the room via `say`, ie: `{client.say('room', Hello World')}`\n- Once a client is in a room, they will revive messages from other members of the room as events. For example, catching say events from the websocket client looks like `{client.on('say', function(message){ console.log(message); })}`. You can inspect `message.room` if you are in more than one room.\n  - The payload of a message will contain the room, sender, and the message body: `{{message: \"Hello World\", room: \"SecretRoom\", from: \"7d419af9-accf-40ac-8d78-9281591dd59e\", context: \"user\", sentAt: 1399437579346}`}\n\nIf you want to create an authenticated room, there are 2 steps:\n\n- First, create an action which modifies some property either on the connection object it self, or stores permissions to a database.\n- Then, create a `join`-style middleware which checks these values. In this middleware, you can determine if the connection should be added to the room or not.\n","name":"chat"}},"page":"/tutorials/[name]","query":{"name":"chat"},"buildId":"cH25b_MVvsTrAlL3XbUsR","nextExport":true,"isFallback":false}</script><script nomodule="" src="/_next/static/runtime/polyfills-d438fb18459bada4da75.js"></script><script async="" data-next-page="/tutorials/[name]" src="/_next/static/cH25b_MVvsTrAlL3XbUsR/pages/tutorials/%5Bname%5D.js"></script><script async="" data-next-page="/_app" src="/_next/static/cH25b_MVvsTrAlL3XbUsR/pages/_app.js"></script><script src="/_next/static/runtime/webpack-b65cab0b00afd201cbda.js" async=""></script><script src="/_next/static/chunks/framework.c1a6d8f83ab8e8b22967.js" async=""></script><script src="/_next/static/chunks/commons.e8528572040b4e4e9696.js" async=""></script><script src="/_next/static/runtime/main-4fc23337c30014ee9849.js" async=""></script><script src="/_next/static/chunks/e3455ea4f5ab842b4397e2e16fe9c64bb70db0dc.47e0d1a9e86c1d20dd79.js" async=""></script><script src="/_next/static/chunks/c592c32e2ecae3769b84f6c98ccafd89b38b2c86.ba5e9ee7f902f9f7167a.js" async=""></script><script src="/_next/static/chunks/a5807bfcda65e4b2d08436e83f0c86f84aba6140.b4273f33c7a002dad56c.js" async=""></script><script src="/_next/static/cH25b_MVvsTrAlL3XbUsR/_buildManifest.js" async=""></script><script src="/_next/static/cH25b_MVvsTrAlL3XbUsR/_ssgManifest.js" async=""></script></body></html>